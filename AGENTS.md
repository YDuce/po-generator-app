# AGENTS.md

## Purpose

Unified handbook for all automated agents (Codex, Cursor, CI bots) working on this repository. Defines roles, coding standards, directory layout, and evolution rules. Keeps instructions minimal but explicit, and allows later amendments without conflict.

## 1. Agent Roles

| Agent      | PrimaryResponsibilities
| **Codex**  | *Architect & Reviewer* – creates feature branches from `develop`, scaffolds interfaces/stubs, performs code reviews, enforces architecture, updates AGENTS.md when global conventions change. |
| **Cursor** | *Executor & Refactorer* – live‑codes in feature branches, implements tests, fixes bugs, follows conventions in this doc, opens PRs for Codex review.                                          |
| **CI bot** | Runs linting, type‑checks, tests. Blocks merge on failures.                                                                                                                                   |

> **Note:** Humans may override agents at any time via PR reviews and AGENTS.md edits.

## 2. Layered Architecture (Core → Channels → API)

```
app/
 ├─ core/        # Vendor‑agnostic domain logic & shared models
 ├─ channels/    # One sub‑package per vendor (woot, amazon, …)
 └─ api/         # HTTP controllers; no business logic
```

*Import rule:* `api → channels → core`. Reverse imports are prohibited.

---

## 3. Coding Standards

* **Language:** Python 3.12
* **Style:** Closest to PEP 8 + black formatting (line ≤ 100). Dunder `__all__` in public modules.
* **Type hints:** Mandatory (`mypy --strict`).
* **Docstrings:** Google style.
* **Tests:** pytest; one test file per module; ≥90 % coverage per layer.

### File Headers (auto‑generated by agents)

```python
"""<Short module summary>

Layer: <core|channels|api>
"""
```

---

## 4. Git Workflow

1. **Codex**: `git switch -c feat/<ticket>` off `develop`; commit scaffolds; push.
2. **Cursor**: code, commit, push to same branch; open PR to `develop`.
3. **Codex**: review, request changes, squash‑merge.
4. **CI bot**: must pass lint + tests before merge.

*Fast fixes*: hotfix branches off `main`, reviewed by Codex.

---

## 5. Secrets Handling

* `.env` is git‑ignored.
* `.env.example` is committed with placeholder keys.

---

## 6. Updating This Document

* Any agent or human may propose edits via PR targeting `docs` label.
* If a later instruction contradicts this file, human maintainer resolves.
* Keep sections terse; remove deprecated rules instead of stacking exceptions.

---

## 7. Glossary

* **PORF** – Purchase Order Request Form (Woot‑specific).
* **PO** – Purchase Order.
* **Connector / Service** – Concrete channel implementation of `BaseChannelOrderService`.

---

## 8. Google Workspace

- App owns one Drive folder per organisation (ensure_workspace)
- All sheets created via core.services.drive/sheets
- Sheets remain read-only until TWO_WAY_SYNC_ENABLED is True

---

*Last updated: 2025-06-11
